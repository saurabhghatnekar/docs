---
id: backend-config
title: 2. Backend config
hide_title: true
---

import AppInfoForm from "/src/components/appInfoForm"
import CoreInjector from "/src/components/coreInjector"

# 2. Backend config

## 1) Create AWS layer for supertokens and middy

- Open terminal and run the following command to create the layers for supertokens and middy.
```bash
mkdir "supertokens-node" && cd "supertokens-node"
```
```bash
npm i --save supertokens-node
```

```bash
mkdir nodejs
```

```bash
cp -r node_modules nodejs
```

```bash
zip -r supertokens-node.zip nodejs
```
- Repeat the above steps for by creating separate folders for middy-core and middy-http-cors and npm install the respective packages and zip them.
```bash
npm i --save @middy/core
```
```bash
npm i --save @middy/http-cors
```

## 2) Upload layers to AWS
- Now, head to AWS Lambda.
As shown in the image below, click on layers
<image src="https://user-images.githubusercontent.com/20884782/190074706-3d1b6420-e812-48d9-aa04-8ea2d4a4c62d.png" width="200" height="200" />

- Then, click in "Create Layer" button
<image src="https://user-images.githubusercontent.com/20884782/190075143-57768a61-7efc-4b3d-a865-0d68e84f3005.png" width="200" height="200" />

- Give a name for your layer, upload the zip and select the nodejs 16 runtime
<image src="https://user-images.githubusercontent.com/20884782/190076214-47e1ba13-3f17-4dcb-afc9-90b3e8c0f53c.png" width="200" height="200" />
- Repeat this for all the 3 modules.

## 3) Create a new Lambda Function
- Create a new lambda function with Node 16 runtime


## 4) Create a configuration file (`config.js`)
- Create a `config.js` file in the root directory of your project.
<image src="https://user-images.githubusercontent.com/20884782/190123110-f465d7b6-7860-4491-bb70-5a2e9da0a4eb.png" width="700" height="500" />
- An example of this file can be found [here](https://github.com/supertokens/supertokens-auth-react/blob/master/examples/with-aws-lambda/backend/config.js).


## 5) Create a backend config function

<AppInfoForm
    askForAppName
    askForAPIDomain
    askForWebsiteDomain
>

    <CoreInjector>

        ```tsx title="config.ts"

        import EmailPassword from 'supertokens-node/recipe/emailpassword';
        import Session from 'supertokens-node/recipe/session'

        function getBackendConfig() {
        return {
        framework: "awsLambda",
        supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
        appInfo: {
        // learn more about this on https://supertokens.com/docs/emailpassword/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}",
        apiGatewayPath: "/dev" // TODO: same as what's set on the frontend config
    },
        recipeList: [
        EmailPassword.init(),
        Session.init(),
        ],
        isInServerlessEnv: true,
    }
    }
        module.exports.getBackendConfig = getBackendConfig;

        ```
    </CoreInjector>

</AppInfoForm>

## 6) Link Layer to the Function

- Scroll to the bottom and look for the `Layers` tab. Click on add layers
<image src="https://user-images.githubusercontent.com/20884782/190076987-02e9f585-d870-4dac-bd96-d55ce71596c4.png" width="700" height="300" />

- Select `Custom Layer` and then select the layer we created in the first step.
<image src="https://user-images.githubusercontent.com/20884782/190077385-55f9db2f-190b-42ed-ab09-70d94ec3b7a3.jpg" width="200" height="200" />

- Add the 3 layers we created in the first step. You layers tab should look something like this
<image src="https://user-images.githubusercontent.com/20884782/190077670-fa4d1db4-67c6-4827-b52f-3f978d36b2be.jpg" width="700" height="200" />
